<!DOCTYPE html>
<html>

<head>
    <title>IO-test</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
        .top {
            font-family: Arial, sans-serif;
            display: grid;
            grid-template-columns: 1fr 300px;
            column-gap: 5px;
        }
        ul {
            font-size: x-small;
        }
        ul button {
            font-size: x-small;
        }
    </style>
</head>
<body>
    <div class="top">
        <div class="main-pane">
            <p title="just pick it!">Choose a CSV file to parse</p>
            <input type="file" id="fileInput" accept=".csv,.xlsx"/>
        </div>
        <div class="side-pane">
            <label for="fileList">Files in memory:</label>
            <ul id="fileList"></ul>
        </div>
    </div>
    <script type="module">
        import { clearDataStore,loadData,ls,getData } from './soccerio.js';
        document.getElementById('fileInput').addEventListener('change', async function(event) {
            const file = event.target.files[0];
            if (!file) return;
            await loadData(file);
            console.log('File loaded:', file.name);
            await updateFileList();
            this.value=''
            window.data = await getData(file.name);
        });

        function createXButton(fileName) {
            const button = document.createElement('button');
            button.style.marginLeft = '10px';
            button.textContent = 'X';
            button.addEventListener('click', function() {
                console.log('Deleting file:', fileName);
                clearDataStore(fileName);
                updateFileList();
            });
            return button;
        }
        function updateFileList() {
            const fileList = document.getElementById('fileList');
            fileList.innerHTML = ''; // Clear the list
            ls().then(files => {
                files.forEach(file => {
                    console.log(file)
                    const li = document.createElement('li');
                    li.textContent = file;
                    li.appendChild(createXButton(file));
                    fileList.appendChild(li);
                });
            });
        }
        document.addEventListener('DOMContentLoaded', updateFileList);
    </script>

</body>

</html>